{"ast":null,"code":"/**\n * A wrapper class to simplify rendering to a texture instead of the final canvas\n * @module ol/webgl/RenderTarget\n */\nimport { equals } from '../array.js';\n\n// for pixel color reading\nconst tmpArray4 = new Uint8Array(4);\n\n/**\n * @classdesc\n * This class is a wrapper around the association of both a `WebGLTexture` and a `WebGLFramebuffer` instances,\n * simplifying initialization and binding for rendering.\n * @api\n */\nclass WebGLRenderTarget {\n  /**\n   * @param {import(\"./Helper.js\").default} helper WebGL helper; mandatory.\n   * @param {Array<number>} [size] Expected size of the render target texture; note: this can be changed later on.\n   */\n  constructor(helper, size) {\n    /**\n     * @private\n     * @type {import(\"./Helper.js\").default}\n     */\n    this.helper_ = helper;\n    const gl = helper.getGL();\n\n    /**\n     * @private\n     * @type {WebGLTexture}\n     */\n    this.texture_ = gl.createTexture();\n\n    /**\n     * @private\n     * @type {WebGLFramebuffer}\n     */\n    this.framebuffer_ = gl.createFramebuffer();\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.size_ = size || [1, 1];\n\n    /**\n     * @type {Uint8Array}\n     * @private\n     */\n    this.data_ = new Uint8Array(0);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.dataCacheDirty_ = true;\n    this.updateSize_();\n  }\n\n  /**\n   * Changes the size of the render target texture. Note: will do nothing if the size\n   * is already the same.\n   * @param {Array<number>} size Expected size of the render target texture\n   * @api\n   */\n  setSize(size) {\n    if (equals(size, this.size_)) {\n      return;\n    }\n    this.size_[0] = size[0];\n    this.size_[1] = size[1];\n    this.updateSize_();\n  }\n\n  /**\n   * Returns the size of the render target texture\n   * @return {Array<number>} Size of the render target texture\n   * @api\n   */\n  getSize() {\n    return this.size_;\n  }\n\n  /**\n   * This will cause following calls to `#readAll` or `#readPixel` to download the content of the\n   * render target into memory, which is an expensive operation.\n   * This content will be kept in cache but should be cleared after each new render.\n   * @api\n   */\n  clearCachedData() {\n    this.dataCacheDirty_ = true;\n  }\n\n  /**\n   * Returns the full content of the frame buffer as a series of r, g, b, a components\n   * in the 0-255 range (unsigned byte).\n   * @return {Uint8Array} Integer array of color values\n   * @api\n   */\n  readAll() {\n    if (this.dataCacheDirty_) {\n      const size = this.size_;\n      const gl = this.helper_.getGL();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer_);\n      gl.readPixels(0, 0, size[0], size[1], gl.RGBA, gl.UNSIGNED_BYTE, this.data_);\n      this.dataCacheDirty_ = false;\n    }\n    return this.data_;\n  }\n\n  /**\n   * Reads one pixel of the frame buffer as an array of r, g, b, a components\n   * in the 0-255 range (unsigned byte).\n   * If x and/or y are outside of existing data, an array filled with 0 is returned.\n   * @param {number} x Pixel coordinate\n   * @param {number} y Pixel coordinate\n   * @return {Uint8Array} Integer array with one color value (4 components)\n   * @api\n   */\n  readPixel(x, y) {\n    if (x < 0 || y < 0 || x > this.size_[0] || y >= this.size_[1]) {\n      tmpArray4[0] = 0;\n      tmpArray4[1] = 0;\n      tmpArray4[2] = 0;\n      tmpArray4[3] = 0;\n      return tmpArray4;\n    }\n    this.readAll();\n    const index = Math.floor(x) + (this.size_[1] - Math.floor(y) - 1) * this.size_[0];\n    tmpArray4[0] = this.data_[index * 4];\n    tmpArray4[1] = this.data_[index * 4 + 1];\n    tmpArray4[2] = this.data_[index * 4 + 2];\n    tmpArray4[3] = this.data_[index * 4 + 3];\n    return tmpArray4;\n  }\n\n  /**\n   * @return {WebGLTexture} Texture to render to\n   */\n  getTexture() {\n    return this.texture_;\n  }\n\n  /**\n   * @return {WebGLFramebuffer} Frame buffer of the render target\n   */\n  getFramebuffer() {\n    return this.framebuffer_;\n  }\n\n  /**\n   * @private\n   */\n  updateSize_() {\n    const size = this.size_;\n    const gl = this.helper_.getGL();\n    this.texture_ = this.helper_.createTexture(size, null, this.texture_);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer_);\n    gl.viewport(0, 0, size[0], size[1]);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texture_, 0);\n    this.data_ = new Uint8Array(size[0] * size[1] * 4);\n  }\n}\nexport default WebGLRenderTarget;","map":{"version":3,"names":["equals","tmpArray4","Uint8Array","WebGLRenderTarget","constructor","helper","size","helper_","gl","getGL","texture_","createTexture","framebuffer_","createFramebuffer","size_","data_","dataCacheDirty_","updateSize_","setSize","getSize","clearCachedData","readAll","bindFramebuffer","FRAMEBUFFER","readPixels","RGBA","UNSIGNED_BYTE","readPixel","x","y","index","Math","floor","getTexture","getFramebuffer","viewport","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D"],"sources":["/Users/lydiaprice/quake-text/Frontend/node_modules/ol/webgl/RenderTarget.js"],"sourcesContent":["/**\n * A wrapper class to simplify rendering to a texture instead of the final canvas\n * @module ol/webgl/RenderTarget\n */\nimport {equals} from '../array.js';\n\n// for pixel color reading\nconst tmpArray4 = new Uint8Array(4);\n\n/**\n * @classdesc\n * This class is a wrapper around the association of both a `WebGLTexture` and a `WebGLFramebuffer` instances,\n * simplifying initialization and binding for rendering.\n * @api\n */\nclass WebGLRenderTarget {\n  /**\n   * @param {import(\"./Helper.js\").default} helper WebGL helper; mandatory.\n   * @param {Array<number>} [size] Expected size of the render target texture; note: this can be changed later on.\n   */\n  constructor(helper, size) {\n    /**\n     * @private\n     * @type {import(\"./Helper.js\").default}\n     */\n    this.helper_ = helper;\n    const gl = helper.getGL();\n\n    /**\n     * @private\n     * @type {WebGLTexture}\n     */\n    this.texture_ = gl.createTexture();\n\n    /**\n     * @private\n     * @type {WebGLFramebuffer}\n     */\n    this.framebuffer_ = gl.createFramebuffer();\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.size_ = size || [1, 1];\n\n    /**\n     * @type {Uint8Array}\n     * @private\n     */\n    this.data_ = new Uint8Array(0);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.dataCacheDirty_ = true;\n\n    this.updateSize_();\n  }\n\n  /**\n   * Changes the size of the render target texture. Note: will do nothing if the size\n   * is already the same.\n   * @param {Array<number>} size Expected size of the render target texture\n   * @api\n   */\n  setSize(size) {\n    if (equals(size, this.size_)) {\n      return;\n    }\n    this.size_[0] = size[0];\n    this.size_[1] = size[1];\n    this.updateSize_();\n  }\n\n  /**\n   * Returns the size of the render target texture\n   * @return {Array<number>} Size of the render target texture\n   * @api\n   */\n  getSize() {\n    return this.size_;\n  }\n\n  /**\n   * This will cause following calls to `#readAll` or `#readPixel` to download the content of the\n   * render target into memory, which is an expensive operation.\n   * This content will be kept in cache but should be cleared after each new render.\n   * @api\n   */\n  clearCachedData() {\n    this.dataCacheDirty_ = true;\n  }\n\n  /**\n   * Returns the full content of the frame buffer as a series of r, g, b, a components\n   * in the 0-255 range (unsigned byte).\n   * @return {Uint8Array} Integer array of color values\n   * @api\n   */\n  readAll() {\n    if (this.dataCacheDirty_) {\n      const size = this.size_;\n      const gl = this.helper_.getGL();\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer_);\n      gl.readPixels(\n        0,\n        0,\n        size[0],\n        size[1],\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        this.data_\n      );\n      this.dataCacheDirty_ = false;\n    }\n    return this.data_;\n  }\n\n  /**\n   * Reads one pixel of the frame buffer as an array of r, g, b, a components\n   * in the 0-255 range (unsigned byte).\n   * If x and/or y are outside of existing data, an array filled with 0 is returned.\n   * @param {number} x Pixel coordinate\n   * @param {number} y Pixel coordinate\n   * @return {Uint8Array} Integer array with one color value (4 components)\n   * @api\n   */\n  readPixel(x, y) {\n    if (x < 0 || y < 0 || x > this.size_[0] || y >= this.size_[1]) {\n      tmpArray4[0] = 0;\n      tmpArray4[1] = 0;\n      tmpArray4[2] = 0;\n      tmpArray4[3] = 0;\n      return tmpArray4;\n    }\n\n    this.readAll();\n    const index =\n      Math.floor(x) + (this.size_[1] - Math.floor(y) - 1) * this.size_[0];\n    tmpArray4[0] = this.data_[index * 4];\n    tmpArray4[1] = this.data_[index * 4 + 1];\n    tmpArray4[2] = this.data_[index * 4 + 2];\n    tmpArray4[3] = this.data_[index * 4 + 3];\n    return tmpArray4;\n  }\n\n  /**\n   * @return {WebGLTexture} Texture to render to\n   */\n  getTexture() {\n    return this.texture_;\n  }\n\n  /**\n   * @return {WebGLFramebuffer} Frame buffer of the render target\n   */\n  getFramebuffer() {\n    return this.framebuffer_;\n  }\n\n  /**\n   * @private\n   */\n  updateSize_() {\n    const size = this.size_;\n    const gl = this.helper_.getGL();\n\n    this.texture_ = this.helper_.createTexture(size, null, this.texture_);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer_);\n    gl.viewport(0, 0, size[0], size[1]);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      this.texture_,\n      0\n    );\n\n    this.data_ = new Uint8Array(size[0] * size[1] * 4);\n  }\n}\n\nexport default WebGLRenderTarget;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}